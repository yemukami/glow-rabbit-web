<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Glow-Rabbit for Race v15 (Modular) - v2.1.0-beta.28</title>
    <link rel="icon" href="image_c2633c.png" type="image/png">
    <link rel="stylesheet" href="css/style.css?v=2.0.1">
</head>
<body>

<header>
    <div class="header-left">
        <img src="image_c2633c.png" alt="Logo" class="logo-mark">
        <div class="system-title">Glow-Rabbit for race<span class="version-inline">v2.1.0-beta.28</span></div>
    </div>
    <div class="header-right">
        <div class="ble-status">â— BLEæœªæ¥ç¶š</div>
        <button class="btn-sm btn-connect" onclick="connectBLE()">ğŸ“¡ æ¥ç¶š</button>
        <button class="btn-sm" style="border:none; background:transparent; font-size:18px; cursor:pointer;" onclick="openVersionModal()">âš™ï¸</button>
        <div class="mode-switch">
            <button class="mode-btn" id="btn-mode-setup" onclick="switchMode('setup')">è¨­å®š</button>
            <button class="mode-btn active" id="btn-mode-race" onclick="switchMode('race')">å®Ÿè¡Œ</button>
            <button class="mode-btn" id="btn-mode-devices" onclick="switchMode('devices')">è¨­ç½®</button>
        </div>
    </div>
</header>

<main>
    <div id="screen-setup" class="screen">
        <div class="setup-card">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <div style="flex:1; margin-right:20px;">
                    <label style="font-size:11px; color:#8E8E93; display:block; margin-bottom:2px;">å¤§ä¼šå</label>
                    <input type="text" class="title-input" id="competition-title" value="ç¬¬74å›å±±å½¢çœŒé•·è·é›¢è¨˜éŒ²ä¼š" onchange="saveCompetitionTitle(this.value)">
                </div>
                <div class="setup-btn-group">
                    <button class="btn-sm btn-outline" onclick="alert('CSVèª­è¾¼')">ğŸ“‚ CSVèª­è¾¼</button>
                    <button class="btn-sm btn-outline" onclick="alert('å±¥æ­´å‘¼ã³å‡ºã—')">ğŸ“‹ å±¥æ­´</button>
                    <button class="btn-sm btn-outline" onclick="alert('å±¥æ­´ã‹ã‚‰æ–°è¦')">ğŸ“‘ ã‚³ãƒ”ãƒ¼æ–°è¦</button>
                    <button class="btn-sm btn-danger" onclick="if(confirm('ã‚¯ãƒªã‚¢?')){clearRaces();}">ğŸ—‘ ã‚¯ãƒªã‚¢</button>
                </div>
            </div>
        </div>
        <table class="data-table">
            <thead>
                <tr>
                    <th style="width:90px;">æ™‚åˆ»</th><th>ç¨®ç›®å</th><th style="width:50px;">çµ„</th>
                    <th style="width:70px;">è·é›¢m</th><th style="width:70px;">Start(m)</th>
                    <th style="width:50px;">äººæ•°</th><th>ãƒšãƒ¼ã‚µãƒ¼è¨­å®š</th><th style="width:60px;"></th>
                </tr>
            </thead>
            <tbody id="setup-tbody"></tbody>
        </table>
        <button class="btn-add-new" onclick="addNewRow()">ï¼‹ æ–°ã—ã„ãƒ¬ãƒ¼ã‚¹ã‚’ä½œæˆ</button>
    </div>

    <div id="screen-race" class="screen active">
        <div id="race-screen-title" style="font-size:24px; font-weight:bold; margin-bottom:20px; padding-left:10px; border-left:6px solid var(--primary-color); color:var(--text-main);"></div>
        <div style="margin-bottom:10px; color:#8E8E93; font-size:13px; text-align:right;">è¡Œã‚’ã‚¿ãƒƒãƒ—ã—ã¦è©³ç´°ã‚’å±•é–‹</div>
        <table class="data-table">
            <tbody id="race-tbody"></tbody>
        </table>
    </div>

    <div id="screen-devices" class="screen">
        <div style="margin-bottom:10px; display:flex; justify-content:space-between; align-items:center;">
            <h2 style="margin:0; font-size:24px; color:var(--primary-color);">ãƒ‡ãƒã‚¤ã‚¹è¨­ç½®</h2>
            <div style="text-align:right;">
                <div id="device-sync-status" class="status-badge status-clean" style="font-size:12px; margin-bottom:4px;">âœ“ åŒæœŸå®Œäº†</div>
                <div style="font-size:11px; color:#888;">è¨­ç½®æ•°: <span id="device-count-display">0 / 0</span></div>
            </div>
        </div>

        <div class="device-settings-panel">
            <div class="setting-group">
                <label class="setting-label">ç·è·é›¢ (m)</label>
                <input type="number" id="setting-distance" class="setting-input" value="400" step="100" onchange="updateRaceSettings(this.value, null)">
            </div>
            <div class="setting-group">
                <label class="setting-label">é–“éš” (m)</label>
                <select id="setting-interval" class="setting-select" onchange="updateRaceSettings(null, this.value)">
                    <option value="1">1m</option>
                    <option value="2" selected>2m</option>
                    <option value="4">4m</option>
                    <option value="5">5m</option>
                </select>
            </div>
            <div style="flex:1; display:flex; justify-content:flex-end; gap:10px; padding-bottom:5px;">
                <button class="btn-sm btn-outline" onclick="fillWithDummy()">ï¼‹ æ®‹ã‚Šã‚’ãƒ€ãƒŸãƒ¼ã§åŸ‹ã‚ã‚‹</button>
                <button class="btn-sm btn-outline" onclick="downloadCSV()">â¬‡ CSVå‡ºåŠ›</button>
                <button class="btn-sm btn-outline" onclick="document.getElementById('csv-input').click()">â¬† CSVå–è¾¼</button>
                <input type="file" id="csv-input" style="display:none" onchange="importCSV(this)" accept=".csv">
                <button class="btn-sm btn-danger" onclick="clearDeviceList()">ğŸ—‘ å…¨å‰Šé™¤</button>
                <button class="btn-sm btn-primary" onclick="syncAllDevices()">ğŸ”„ åŒæœŸ</button>
            </div>
        </div>

        <div style="margin-bottom:10px; background:#FFF3CD; padding:10px; border-radius:8px; font-size:13px; color:#856404;">
            â€» <strong>ç™»éŒ²æ–¹æ³•:</strong> Glow-Ræœ¬ä½“ã®ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨è‡ªå‹•è¿½åŠ ã•ã‚Œã¾ã™ã€‚<br>
            â€» <strong>æ“ä½œ:</strong> ãƒã‚¹ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€Œãƒ†ã‚¹ãƒˆç‚¹ç¯ã€ã€Œãƒ€ãƒŸãƒ¼åŒ–ã€ã€Œäº¤æ›ã€ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãŒé–‹ãã¾ã™ã€‚
        </div>
        
        <div id="device-list-container">
            <!-- Grid Rendered by JS -->
        </div>
    </div>
</main>

<style>
    /* Modal Tabs */
    .modal-tabs { display: flex; border-bottom: 1px solid #E1E5EA; margin-bottom: 20px; }
    .modal-tab { flex: 1; text-align: center; padding: 10px; cursor: pointer; font-weight: bold; color: #8E8E93; border-bottom: 3px solid transparent; }
    .modal-tab.active { color: var(--primary-color); border-bottom-color: var(--primary-color); }
    .tab-content { display: none; }
    .tab-content.active { display: block; }
    
    /* Segment Table */
    .segment-table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    .segment-table th { text-align: left; font-size: 12px; color: #888; padding-bottom: 5px; }
    .segment-table td { padding: 5px 0; }
    .segment-input { width: 70px; padding: 6px; border: 1px solid #DDD; border-radius: 6px; text-align: center; font-weight: bold; }
</style>

<div id="modal-settings" class="modal-overlay">
    <div class="modal-content" style="width: 500px;">
        <h3 style="margin-top:0;">ãƒšãƒ¼ã‚µãƒ¼è¨­å®š</h3>
        
        <div class="color-selector">
            <div class="color-option bg-red" onclick="selectModalColor('red')"></div>
            <div class="color-option bg-blue" onclick="selectModalColor('blue')"></div>
            <div class="color-option bg-green" onclick="selectModalColor('green')"></div>
            <div class="color-option bg-yellow" onclick="selectModalColor('yellow')"></div>
            <div class="color-option bg-purple" onclick="selectModalColor('purple')"></div>
            <div class="color-option bg-white" onclick="selectModalColor('white')"></div>
        </div>

        <div class="modal-tabs">
            <div class="modal-tab active" id="tab-btn-simple" onclick="switchModalTab('simple')">ã‚·ãƒ³ãƒ—ãƒ«è¨­å®š</div>
            <div class="modal-tab" id="tab-btn-segments" onclick="switchModalTab('segments')">åŒºé–“è¨­å®š</div>
        </div>

        <!-- TAB 1: SIMPLE (Target Time) -->
        <div id="tab-content-simple" class="tab-content active">
            <div style="display:flex; align-items:center; justify-content:center; gap:15px; margin:20px 0;">
                <div style="text-align:center;">
                    <label style="font-size:11px; color:#888; display:block;">ã‚´ãƒ¼ãƒ«ç›®æ¨™ã‚¿ã‚¤ãƒ </label>
                    <input type="text" id="modal-target-time" placeholder="ä¾‹ 3:25.5" style="font-size:28px; width:140px; text-align:center; padding:8px; border-radius:10px; border:1px solid #ddd;">
                </div>
            </div>
            <p style="text-align:center; color:#666; font-size:14px;">
                å¹³å‡ãƒšãƒ¼ã‚¹: <strong id="modal-calc-pace" style="color:var(--primary-color);">--.-</strong> ç§’ / 400m
            </p>
        </div>

        <!-- TAB 2: SEGMENTS -->
        <div id="tab-content-segments" class="tab-content">
            <div style="max-height: 200px; overflow-y: auto;">
                <table class="segment-table">
                    <thead><tr><th>è·é›¢(m)ã¾ã§</th><th>ãƒšãƒ¼ã‚¹(ç§’/400m)</th><th></th></tr></thead>
                    <tbody id="segment-tbody">
                        <!-- Generated by JS -->
                    </tbody>
                </table>
                <button class="btn-sm btn-outline" style="width:100%; margin-top:10px;" onclick="addSegmentRow()">ï¼‹ åŒºé–“ã‚’è¿½åŠ </button>
                <p id="segment-total-time" style="margin-top:8px; font-size:13px; color:#555; text-align:right;">ã‚´ãƒ¼ãƒ«äºˆæƒ³ã‚¿ã‚¤ãƒ : --:--.-</p>
            </div>
        </div>

        <div style="display:flex; justify-content:space-between; margin-top:20px;">
            <button class="btn-sm btn-danger" style="border:none; background:#FFF0F0;" onclick="deletePacerFromModal()">å‰Šé™¤</button>
            <div style="display:flex; gap:10px;">
                <button class="btn-sm btn-outline" style="border:none; background:#F2F2F7; color:#555;" onclick="closeModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                <button class="btn-sm btn-primary" style="padding:10px 24px; font-size:14px;" onclick="saveModalData()">è¨­å®šã‚’ä¿å­˜</button>
            </div>
        </div>
    </div>
</div>

<div id="modal-version" class="modal-overlay" onclick="if(event.target===this) closeVersionModal()">
    <div class="modal-content" style="text-align:center; width:300px;">
        <img src="image_c2633c.png" style="width:60px; margin-bottom:10px;">
        <h3>Glow-Rabbit Web</h3>
        <p style="color:#888; font-family:monospace;">Version: 2.1.0-beta.28</p>
        <p style="color:#CCC; font-size:12px;">Fix: Guard modal tab globals</p>
        <button class="btn-sm btn-primary" onclick="closeVersionModal()">é–‰ã˜ã‚‹</button>
    </div>
</div>

<script type="module" src="main.js"></script>
</body>
</html>
